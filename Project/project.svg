<svg xmlns="http://www.w3.org/2000/svg" xmlns:html="http://www.w3.org/1999/xhtml" width="1000" height="800" style="background-Color: black;">
	<!--
		Zombie Massacre
		HKUST Summer Institute 2015 SISP 1305 Group 1 Project

		(c) 2015 SISP 1305 Group 1.  All rights reserved.
	-->
	<title>Zombie Massacre</title>
	<script>
		<![CDATA[
			var player;
			var normalZombie1, normalZombiesLeft = 1;
			var hardZombie1;
			var minionZombie1;
			var bossZombie;

			function showInstructions() {
				document.getElementById("startButton").setAttribute("onmousedown", "");
				document.getElementById("startScreen").setAttribute("visibility", "hidden");
				document.getElementById("instructions").setAttribute("visibility", "visible");
				document.getElementById("buttonClick").play();
			}
			function init() {
				document.getElementById("proceed").setAttribute("onmousedown", "");
				document.getElementById("instructions").setAttribute("visibility", "hidden");
				document.getElementById("gameScene").setAttribute("visibility", "visible");
				document.getElementById("buttonClick").play();
				startGame();
			}
			function startGame() {
				player = {
					x: 500,
					y: 400,
					r: 50,
					svgEquiv: document.getElementById("player"),
					move: function(dir) {
						switch (dir) {
							case "left":
							player.x -= 15;
							break;
							case "right":
							player.x += 15;
							break;
							case "up":
							player.y -= 15;
							break;
							case "down":
							player.y += 15;
							break;
							default:
							alert("ERROR!  THIS DIRECTION DOES NOT EXIST!  CHECK YOUR CODE!");
						}
						player.svgEquiv.setAttribute("transform", "translate("+player.x+" "+player.y+")");
					},
					init: function() {
						player.svgEquiv.setAttribute("transform", "translate("+player.x+" "+player.y+")");
						player.svgEquiv.setAttribute("visibility", "visible");
					},
					preventEscape: function() {
						if (player.x < 0) {
							player.x = 0;
						} else if (player.y < 0) {
							player.y = 0;
						} else if (player.x > 1000) {
							player.x = 1000;
						} else if (player.y > 800) {
							player.y = 800;
						} else {
							void(0);
						}
						player.svgEquiv.setAttribute("transform", "translate("+player.x+" "+player.y+")");
					}
				};
				player.init();
				document.onkeydown = function(event) {
					/*
						Key Codes
						---------
						W = 87
						A = 65
						S = 83
						D = 68
					*/
					switch (event.keyCode) {
						case 87:
						player.move("up");
						break;
						case 65:
						player.move("left");
						break;
						case 83:
						player.move("down");
						break;
						case 68:
						player.move("right");
						break;
					}
					player.preventEscape();
				}
				document.onmousedown = function() {
					document.getElementById("gunshotSFX").play();
				}
				function Zombie(svgEquiv, x, y, r, health, stepMoves) {
					this.svgEquiv = svgEquiv;
					this.x = x;
					this.y = y;
					this.r = r;
					this.health = health;
					this.stepMoves = stepMoves;
					this.currentStepCount = 0;
					this.stepX = 0;
					this.stepY = 0;
					this.stepTimer = function() {
						void(0);
					}
					this.startPos = function() {
						this.svgEquiv.setAttribute("transform", "translate("+this.x+" "+this.y+")");
						this.svgEquiv.setAttribute("visibility", "visible");
					}
					this.detectCollisionWithPlayer = function() {
						if ((this.x - player.x) * (this.x - player.x) + (this.y - player.y) * (this.y - player.y) <= (this.r + player.r) * (this.r + player.r)) {
							// Collision!  Disable everything and show Game Over Screen
							// Hide Normal Zombies
							normalZombie1.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie2.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie3.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie4.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie5.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie6.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie7.svgEquiv.setAttribute("visibility", "hidden");
							// normalZombie8.svgEquiv.setAttribute("visibility", "hidden");
							// Hide Hard Zombies
							// hardZombie1.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie2.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie3.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie4.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie5.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie6.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie7.svgEquiv.setAttribute("visibility", "hidden");
							// hardZombie8.svgEquiv.setAttribute("visibility", "hidden");
							// Hide Minion Zombies (Boss Battle)
							// minionZombie1.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie2.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie3.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie4.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie5.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie6.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie7.svgEquiv.setAttribute("visibility", "hidden");
							// minionZombie8.svgEquiv.setAttribute("visibility", "hidden");
							// Hide Boss Zombie (Boss Battle)
							// bossZombie.svgEquiv.setAttribute("visibility", "hidden");
							// Hide Player (of course :p)
							player.svgEquiv.setAttribute("visibility", "hidden");
							// Disable all onmousedown events
							normalZombie1.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie2.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie3.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie4.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie5.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie6.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie7.svgEquiv.setAttribute("onmousedown", "");
							// normalZombie8.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie1.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie2.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie3.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie4.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie5.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie6.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie7.svgEquiv.setAttribute("onmousedown", "");
							// hardZombie8.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie1.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie2.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie3.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie4.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie5.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie6.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie7.svgEquiv.setAttribute("onmousedown", "");
							// minionZombie8.svgEquiv.setAttribute("onmousedown", "");
							// bossZombie.svgEquiv.setAttribute("onmousedown", "");
							// Disable Keyboard Controls
							document.onkeydown = function(event) {
								void(0);
							}
							// Clear all intervals
							clearInterval(normalZombie1.stepTimer);
							// clearInterval(normalZombie2.stepTimer);
							// clearInterval(normalZombie3.stepTimer);
							// clearInterval(normalZombie4.stepTimer);
							// clearInterval(normalZombie5.stepTimer);
							// clearInterval(normalZombie6.stepTimer);
							// clearInterval(normalZombie7.stepTimer);
							// clearInterval(normalZombie8.stepTimer);
							// clearInterval(hardZombie1.stepTimer);
							// clearInterval(hardZombie2.stepTimer);
							// clearInterval(hardZombie3.stepTimer);
							// clearInterval(hardZombie4.stepTimer);
							// clearInterval(hardZombie5.stepTimer);
							// clearInterval(hardZombie6.stepTimer);
							// clearInterval(hardZombie7.stepTimer);
							// clearInterval(hardZombie8.stepTimer);
							// clearInterval(minionZombie1.stepTimer);
							// clearInterval(minionZombie2.stepTimer);
							// clearInterval(minionZombie3.stepTimer);
							// clearInterval(minionZombie4.stepTimer);
							// clearInterval(minionZombie5.stepTimer);
							// clearInterval(minionZombie6.stepTimer);
							// clearInterval(minionZombie7.stepTimer);
							// clearInterval(minionZombie8.stepTimer);
							// And maybe something about the Boss here (add code here later)?
							// Undefine Everything
							normalZombie1 = undefined;
							// normalZombie2 = undefined;
							// normalZombie3 = undefined;
							// normalZombie4 = undefined;
							// normalZombie5 = undefined;
							// normalZombie6 = undefined;
							// normalZombie7 = undefined;
							// normalZombie8 = undefined;
							// hardZombie1 = undefined;
							// hardZombie2 = undefined;
							// hardZombie3 = undefined;
							// hardZombie4 = undefined;
							// hardZombie5 = undefined;
							// hardZombie6 = undefined;
							// hardZombie7 = undefined;
							// hardZombie8 = undefined;
							// minionZombie1 = undefined;
							// minionZombie2 = undefined;
							// minionZombie3 = undefined;
							// minionZombie4 = undefined;
							// minionZombie5 = undefined;
							// minionZombie6 = undefined;
							// minionZombie7 = undefined;
							// minionZombie8 = undefined;
							player = undefined;
							// Hide Game Screen and show Game Over Screen
							document.getElementById("gameScene").setAttribute("visibility", "hidden");
							document.getElementById("gameOver").setAttribute("visibility", "visible");
							// Player loses
							document.getElementById("gameOverText").setAttribute("visibility", "visible");
							// Enable Restart Button
							document.getElementById("gameOverRestart").setAttribute("onmousedown", "location.reload()");
							// Play agonising scream :p
							document.getElementById("playerScream").play();
						}
					}
				}
				normalZombie1 = new Zombie(document.getElementById("normalZombie1"), 0, 400, 50, 1, 200);
				normalZombie1.startPos();
				normalZombie1.targetPlayer = function() {
					normalZombie1.stepX = (player.x - normalZombie1.x) / normalZombie1.stepMoves;
					normalZombie1.stepY = (player.y - normalZombie1.y) / normalZombie1.stepMoves;
					normalZombie1.currentStepCount = 0;
					normalZombie1.stepTimer = setTimeout(function() {
						normalZombie1.move();
					}, 10);
				}
				normalZombie1.move = function() {
					normalZombie1.x += normalZombie1.stepX;
					normalZombie1.y += normalZombie1.stepY;
					normalZombie1.svgEquiv.setAttribute("transform", "translate("+normalZombie1.x+" "+normalZombie1.y+")");
					normalZombie1.currentStepCount ++;
					if (normalZombie1.currentStepCount < normalZombie1.stepMoves) {
						normalZombie1.stepTimer = setTimeout(function() {
							normalZombie1.move();
						}, 10);
					} else {
						normalZombie1.stepTimer = setTimeout(function() {
							normalZombie1.targetPlayer();
						}, 10);
					}
					normalZombie1.detectCollisionWithPlayer();
				}
				normalZombie1.loseHealth = function() {
					normalZombie1.health --;
					document.getElementById("gunshotSFX").play();
					if (normalZombie1.health <= 0) {
						// Zombie dies.  Disable Zombie
						normalZombie1.svgEquiv.setAttribute("visibility", "hidden");
						normalZombie1.svgEquiv.setAttribute("onmousedown", "");
						clearInterval(normalZombie1.stepTimer);
						normalZombie1 = undefined;
						normalZombiesLeft --;
						checkNormalZombiesNum();
					}
				}
				function checkNormalZombiesNum() {
					if (normalZombiesLeft <= 0) {
						releaseHardZombies();
					}
				}
				function releaseHardZombies() {
					alert("All normal zombies killed!  Release Hard Zombies!");  // INCOMPLETE
				}
				normalZombie1.svgEquiv.setAttribute("onmousedown", "normalZombie1.loseHealth()");
				normalZombie1.targetPlayer();
			}
		]]>
	</script>
	<defs>
		<linearGradient id="buttonGrad">
			<stop offset="0" style="stop-color: rgb(255, 154, 139);"></stop>
			<stop offset="0.5" style="stop-color: red;"></stop>
			<stop offset="1" style="stop-color: rgb(255, 154, 139);"></stop>
		</linearGradient>
	</defs>
	<g id="startScreen" visibility="visible">
		<text x="125" y="150" style="font-Size: 75px; fill: red;">ZOMBIE MASSACRE</text>
		<g id="startButton" onmousedown="showInstructions()">
			<rect x="350" y="360" width="300" height="80" style="fill: url(#buttonGrad);"></rect>
			<text x="375" y="410" style="font-Size: 40px; fill: black;">START GAME</text>
		</g>
	</g>
	<g id="instructions" visibility="hidden">
		<text x="300" y="100" style="font-Size: 50px; fill: red;">INSTRUCTIONS</text>
		<text x="100" y="150" style="font-Size: 25px; fill: red;">1. Use the WASD keys to move around.</text>
		<text x="100" y="200" style="font-Size: 25px; fill: red;">2. Avoid incoming zombies.  Do NOT touch them.</text>
		<text x="100" y="250" style="font-Size: 25px; fill: red;">3. You should also shoot and kill them zombies by clicking on them.</text>
		<text x="100" y="300" style="font-Size: 25px; fill: red;">4. Some zombies may take more than one hit to kill them.</text>
		<text x="100" y="350" style="font-Size: 25px; fill: red;">5. In the end there is a BOSS.  Keep shooting it to kill it.  A health bar will show its health.</text>
		<g id="proceed" onmousedown="init()">
			<rect x="350" y="570" width="300" height="60" style="fill: url(#buttonGrad);"></rect>
			<text x="375" y="610" style="font-Size: 20px; fill: black;">I UNDERSTAND, CONTINUE</text>
		</g>
	</g>
	<g id="gameScene" visibility="hidden">
		<g id="horizontalRoad">
			<rect x="0" y="350" width="1000" height="100" style="fill: grey;"></rect>
			<rect x="0" y="390" width="100" height="20" style="fill: white;"></rect>
			<rect x="150" y="390" width="100" height="20" style="fill: white;"></rect>
			<rect x="300" y="390" width="100" height="20" style="fill: white;"></rect>
			<rect x="600" y="390" width="100" height="20" style="fill: white;"></rect>
			<rect x="750" y="390" width="100" height="20" style="fill: white;"></rect>
			<rect x="900" y="390" width="100" height="20" style="fill: white;"></rect>
		</g>
		<g id="verticalRoad">
			<rect x="450" y="0" width="100" height="1000" style="fill: grey;"></rect>
			<rect x="490" y="0" width="20" height="100" style="fill: white;"></rect>
			<rect x="490" y="150" width="20" height="100" style="fill: white;"></rect>
			<rect x="490" y="300" width="20" height="100" style="fill: white;"></rect>
			<rect x="490" y="450" width="20" height="100" style="fill: white;"></rect>
			<rect x="490" y="600" width="20" height="100" style="fill: white;"></rect>
			<rect x="490" y="750" width="20" height="100" style="fill: white;"></rect>
		</g>
		<g id="player" visibility="hidden">
			<g id="playerTransform" transform="translate(0 0)">
				<circle cx="0" cy="0" r="50" style="fill: #ffe9b3; stroke: #ffe9b3;"></circle>
				<ellipse cx="-15" cy="-20" rx="10" ry="20" style="fill: white; stroke: black;"></ellipse>
				<ellipse cx="15" cy="-20" rx="10" ry="20" style="fill: white; stroke: black;"></ellipse>
				<circle cx="-15" cy="-5" r="5" style="fill: black;">
					<animateTransform attributeName="transform" type="translate" additive="sum" begin="0s" dur="3s" values="0 0; -5 -15; 0 -30; 5 -15; 0 0" repeatCount="indefinite" />
				</circle>
				<circle cx="15" cy="-5" r="5" style="fill: black;">
					<animateTransform attributeName="transform" type="translate" additive="sum" begin="0s" dur="3s" values="0 0; -5 -15; 0 -30; 5 -15; 0 0" repeatCount="indefinite" />
				</circle>
				<path d="M -20 20 L -18 25 L -16 29 L -14 32 L -12 35 L -10 37 L -5 39 L 0 40 L 5 39 L 10 37 L 12 35 L 14 32 L 16 29 L 18 25 L 20 20 z" style="fill: red; stroke: black;"></path>
			</g>
		</g>
		<g id="normalZombie1" visibility="hidden">
			<g id="normalZombie1Transform" transform="translate(0 0)">
				<circle cx="0" cy="0" r="50" style="fill: #A7FFA7; stroke: #A7FFA7;"></circle>
				<circle cx="-15" cy="-22.5" r="10" style="fill: white; stroke: black;"></circle>
				<circle cx="15" cy="-22.5" r="10" style="fill: white; stroke: black;"></circle>
				<circle cx="-15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="2s" values="270 -15 -22.5; 450 -15 -22.5; 270 -15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="2s" values="270 15 -22.5; 450 15 -22.5; 270 15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="0" cy="25" r="17.5" style="fill: red; stroke: black; stroke-width: 5;"></circle>
			</g>
		</g>
		<g id="hardZombie1" visibility="hidden">
			<g id="hardZombie1Transform" transform="translate(0 0)">
				<circle cx="0" cy="0" r="50" style="fill: red; stroke: red;"></circle>
				<circle cx="-15" cy="-22.5" r="10" style="fill: #a7ffa7; stroke: black;"></circle>
				<circle cx="15" cy="-22.5" r="10" style="fill: #a7ffa7; stroke: black;"></circle>
				<circle cx="-15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="2s" values="270 -15 -22.5; 450 -15 -22.5; 270 -15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="2s" values="270 15 -22.5; 450 15 -22.5; 270 15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="0" cy="25" r="17.5" style="fill: black; stroke: black; stroke-width: 5;"></circle>
			</g>
		</g>
		<g id="minionZombie1" visibility="hidden">
			<g id="minionZombie1Transform" transform="translate(0 0)">
				<circle cx="0" cy="0" r="50" style="fill: yellow; stroke: yellow;"></circle>
				<circle cx="-15" cy="-22.5" r="10" style="fill: white; stroke: black;"></circle>
				<circle cx="15" cy="-22.5" r="10" style="fill: white; stroke: black;"></circle>
				<circle cx="-15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="0.5s" values="0 -15 -22.5; 360 -15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="15" cy="-17.5" r="5" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="0.5s" values="180 15 -22.5; 540 15 -22.5" repeatCount="indefinite" />
				</circle>
				<circle cx="0" cy="25" r="17.5" style="fill: red; stroke: black; stroke-width: 5;"></circle>
			</g>
		</g>
		<g id="bossZombie" visibility="hidden">
			<g id="bossZombieTransform" transform="translate(0 0)">
				<circle cx="0" cy="0" r="200" style="fill: green; stroke: green;"></circle>
				<circle cx="-60" cy="-90" r="40" style="fill: red; stroke: black;"></circle>
				<circle cx="60" cy="-90" r="40" style="fill: red; stroke: black;"></circle>
				<circle cx="-60" cy="-70" r="20" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="1s" values="0 -60 -90; 360 -60 -90" repeatCount="indefinite" />
				</circle>
				<circle cx="60" cy="-70" r="20" style="fill: black; stroke: black;">
					<animateTransform attributeName="transform" type="rotate" additive="sum" begin="0s" dur="1s" values="0 60 -90; 360 60 -90" repeatCount="indefinite" />
				</circle>
				<circle cx="0" cy="100" r="70" style="fill: black; stroke: black; stroke-width: 5;"></circle>
			</g>
		</g>
	</g>
	<g id="gameOver" visibility="hidden">
		<text id="gameOverText" x="200" y="150" style="fill: red; font-Size: 100px;" visibility="hidden">GAME OVER</text>
		<text id="gameOverWinText" x="250" y="150" style="fill: red; font-Size: 100px;" visibility="hidden">YOU WIN!</text>
		<g id="gameOverRestart" onmousedown="void(0)">
			<rect x="350" y="350" width="300" height="100" style="fill: url(#buttonGrad);"></rect>
			<text x="390" y="420" style="font-Size: 50px; fill: black;">RESTART</text>
		</g>
	</g>
	<html:audio src="assets/background.ogg" id="backgroundMusic" autoplay="autoplay" loop="loop"></html:audio>
	<html:audio src="assets/button-click.ogg" id="buttonClick"></html:audio>
	<html:audio src="assets/gunshot.ogg" id="gunshotSFX"></html:audio>
	<html:audio src="assets/scream.ogg" id="playerScream"></html:audio>
</svg>
